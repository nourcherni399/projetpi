{% extends 'base.html.twig' %}

{% block body %}
<div class="min-h-screen flex flex-col">
    <header class="bg-white shadow-sm shrink-0">
        <div class="max-w-6xl mx-auto pl-2 pr-4 py-4 flex flex-nowrap items-center gap-6">
            <a href="{{ path('home') }}" class="flex items-center gap-3 text-[#4B5563] font-semibold text-lg shrink-0 mr-8" title="AutiCare - Accueil">
                <img src="{{ asset('images/logo.png') }}" alt="AutiCare" class="h-16 w-auto object-contain" />
                <span class="hidden md:inline whitespace-nowrap text-[#4B5563]">AutiCare</span>
            </a>
            <div class="flex flex-nowrap items-center gap-4 md:gap-5 flex-1 min-w-0 justify-end">
            <nav class="flex flex-nowrap items-center gap-2 md:gap-4 shrink-0 pl-4 border-l border-[#E5E0D8]" aria-label="Navigation principale">
                <a href="{{ path('home') }}" class="flex items-center gap-1.5 text-[#6B7280] hover:text-[#A7C7E7] focus:outline focus:ring-2 focus:ring-[#A7C7E7] rounded px-2 py-1 whitespace-nowrap">
                    <svg class="w-5 h-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" /></svg>
                    <span class="hidden sm:inline">Accueil</span>
                </a>
                <a href="{{ path('user_products_index') }}" class="flex items-center gap-1.5 text-[#6B7280] hover:text-[#A7C7E7] focus:outline focus:ring-2 focus:ring-[#A7C7E7] rounded px-2 py-1 whitespace-nowrap">
                    <svg class="w-5 h-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" /></svg>
                    <span class="hidden sm:inline">Produits</span>
                </a>
                <a href="{{ path('user_appointments') }}" class="flex items-center gap-1.5 text-[#6B7280] hover:text-[#A7C7E7] focus:outline focus:ring-2 focus:ring-[#A7C7E7] rounded px-2 py-1 whitespace-nowrap">
                    <svg class="w-5 h-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <span class="hidden sm:inline">Rendez-vous</span>
                </a>
                <a href="{{ path('user_events') }}" class="flex items-center gap-1.5 text-[#6B7280] hover:text-[#A7C7E7] focus:outline focus:ring-2 focus:ring-[#A7C7E7] rounded px-2 py-1 whitespace-nowrap">
                    <svg class="w-5 h-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" /></svg>
                    <span class="hidden sm:inline">Événements</span>
                </a>
                <a href="{{ path('user_blog') }}" class="flex items-center gap-1.5 text-[#6B7280] hover:text-[#A7C7E7] focus:outline focus:ring-2 focus:ring-[#A7C7E7] rounded px-2 py-1 whitespace-nowrap">
                    <svg class="w-5 h-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.256A8.967 8.967 0 016 18c2.295 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.256A8.967 8.967 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>
                    <span class="hidden sm:inline">Blog</span>
                </a>
            </nav>
            <div class="flex flex-nowrap items-center gap-2 md:gap-3 shrink-0 pl-4 border-l border-[#E5E0D8]">
                {% if app.user %}
                    {% set _notif_count = (user_inscription_notifications|default([])|length) + (user_rdv_notifications|default([])|length) %}
                    {% set _event_notifs_header = user_inscription_notifications|default([]) %}
                    {% set _rdv_notifs_header = user_rdv_notifications|default([]) %}
                    <a href="{{ path('favoris_index') }}" class="relative p-2 text-[#6B7280] hover:text-[#A7C7E7] focus:outline focus:ring-2 focus:ring-[#A7C7E7] rounded-full" title="Mes favoris" aria-label="Mes favoris">
                        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.256A8.967 8.967 0 016 18c2.295 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.256A8.967 8.967 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                        </svg>
                    </a>
                    <a href="{{ path('cart_index') }}" class="relative p-2 text-[#6B7280] hover:text-[#A7C7E7] focus:outline focus:ring-2 focus:ring-[#A7C7E7] rounded-full" title="Mon panier" aria-label="Panier{% if app_cart_count|default(0) > 0 %} ({{ app_cart_count }} article(s)){% endif %}">
                        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" /></svg>
                        {% if app_cart_count|default(0) > 0 %}
                        <span class="absolute -top-0.5 -right-0.5 flex h-5 min-w-[1.25rem] items-center justify-center rounded-full bg-[#A7C7E7] px-1.5 text-xs font-medium text-white">{{ app_cart_count > 99 ? '99+' : app_cart_count }}</span>
                        {% endif %}
                    </a>
                    <div class="relative" id="notif-dropdown-wrap">
                        <button type="button" id="notif-dropdown-btn" aria-expanded="false" aria-haspopup="true" aria-controls="notif-dropdown-panel" class="relative p-2 text-[#6B7280] hover:text-[#A7C7E7] focus:outline focus:ring-2 focus:ring-[#A7C7E7] rounded-full" title="Voir mes notifications" aria-label="Notifications{% if _notif_count > 0 %} ({{ _notif_count }}){% endif %}">
                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" /></svg>
                            {% if _notif_count > 0 %}
                            <span class="absolute -top-0.5 -right-0.5 flex h-5 min-w-[1.25rem] items-center justify-center rounded-full bg-[#DC2626] px-1.5 text-xs font-medium text-white">{{ _notif_count > 99 ? '99+' : _notif_count }}</span>
                            {% endif %}
                        </button>
                        <div id="notif-dropdown-panel" class="absolute right-0 top-full mt-2 w-[380px] max-w-[calc(100vw-2rem)] bg-white rounded-xl shadow-lg border border-[#E5E0D8] z-50 overflow-hidden hidden" role="region" aria-label="Liste des notifications">
                            <div class="p-3 border-b border-[#E5E0D8] bg-white">
                                <h2 class="font-semibold text-[#4B5563] text-base">Notifications</h2>
                            </div>
                            <div class="max-h-[min(70vh,420px)] overflow-y-auto">
                                {% if _event_notifs_header is empty and _rdv_notifs_header is empty %}
                                <div class="p-6 text-center text-[#6B7280] text-sm">Aucune notification.</div>
                                {% else %}
                                <div class="p-2 space-y-1">
                                    {% for notif in _event_notifs_header %}
                                    <a href="{{ path('user_event_show', { id: notif.eventId }) }}" class="block rounded-lg focus:outline focus:ring-2 focus:ring-[#A7C7E7] focus:ring-inset notif-dropdown-link">
                                        {% if notif.type == 'acceptee' %}
                                        <div class="p-3 rounded-lg bg-emerald-50 border border-emerald-200 text-emerald-800 text-sm font-medium flex items-center gap-3">
                                            <span class="shrink-0 flex items-center justify-center w-9 h-9 rounded-full bg-emerald-100 text-emerald-600"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></span>
                                            <span class="min-w-0">{{ notif.message }}</span>
                                        </div>
                                        {% elseif notif.type == 'liste_attente' %}
                                        <div class="p-3 rounded-lg bg-sky-50 border border-sky-200 text-sky-800 text-sm font-medium flex items-center gap-3">
                                            <span class="shrink-0 flex items-center justify-center w-9 h-9 rounded-full bg-sky-100 text-sky-600"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></span>
                                            <span class="min-w-0">{{ notif.message }}</span>
                                        </div>
                                        {% else %}
                                        <div class="p-3 rounded-lg bg-amber-50 border border-amber-200 text-amber-800 text-sm font-medium flex items-center gap-3">
                                            <span class="shrink-0 flex items-center justify-center w-9 h-9 rounded-full bg-amber-100 text-amber-600"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></span>
                                            <span class="min-w-0">{{ notif.message }}</span>
                                        </div>
                                        {% endif %}
                                    </a>
                                    {% endfor %}
                                    {% for notif in _rdv_notifs_header %}
                                    <div class="p-3 rounded-lg text-sm font-medium flex items-center gap-3 {% if notif.type == 'rdv_accepte' %}bg-emerald-50 border border-emerald-200 text-emerald-800{% else %}bg-amber-50 border border-amber-200 text-amber-800{% endif %}">
                                        {% if notif.type == 'rdv_accepte' %}
                                        <span class="shrink-0 flex items-center justify-center w-9 h-9 rounded-full bg-emerald-100 text-emerald-600"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></span>
                                        {% else %}
                                        <span class="shrink-0 flex items-center justify-center w-9 h-9 rounded-full bg-amber-100 text-amber-600"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></span>
                                        {% endif %}
                                        <span class="min-w-0">{{ notif.message }}</span>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="p-2 border-t border-[#E5E0D8] bg-[#F5F1EB]">
                                <a href="{{ path('user_notifications') }}" class="block text-center py-2.5 text-sm font-medium text-[#A7C7E7] hover:text-[#4B5563] rounded-lg notif-dropdown-link">Voir toutes les notifications</a>
                            </div>
                        </div>
                    </div>
                    <script>
                    (function() {
                        var wrap = document.getElementById('notif-dropdown-wrap');
                        var btn = document.getElementById('notif-dropdown-btn');
                        var panel = document.getElementById('notif-dropdown-panel');
                        if (!wrap || !btn || !panel) return;
                        function open() { panel.classList.remove('hidden'); btn.setAttribute('aria-expanded', 'true'); }
                        function close() { panel.classList.add('hidden'); btn.setAttribute('aria-expanded', 'false'); }
                        function toggle() { panel.classList.contains('hidden') ? open() : close(); }
                        btn.addEventListener('click', function(e) { e.preventDefault(); e.stopPropagation(); toggle(); });
                        document.addEventListener('click', function(e) { if (wrap.contains(e.target)) return; close(); });
                        document.querySelectorAll('.notif-dropdown-link').forEach(function(el) { el.addEventListener('click', close); });
                    })();
                    </script>
                    <div class="flex items-center gap-3">
                        <a href="{{ path('user_profile') }}" class="flex items-center justify-center w-10 h-10 rounded-full overflow-hidden bg-[#A7C7E7] text-white font-semibold text-sm shrink-0 hover:opacity-90 transition-opacity" title="Modifier mon profil">{% if app.user.image %}<img src="{{ asset(app.user.image) }}" alt="" class="w-full h-full object-cover">{% else %}{{ (app.user.prenom|slice(0,1) ~ app.user.nom|slice(0,1))|upper }}{% endif %}</a>
                        <div class="flex flex-col items-start min-w-0">
                            <a href="{{ path('user_profile') }}" class="font-medium text-[#4B5563] hover:text-[#A7C7E7] whitespace-nowrap">{{ app.user.prenom }} {{ app.user.nom }} <span class="text-[#DC2626]">{{ '%04d'|format(app.user.id) }}</span></a>
                            <a href="{{ path('app_logout') }}" class="text-[#9CA3AF] hover:text-[#6B7280] text-sm focus:outline focus:ring-2 focus:ring-[#A7C7E7] rounded whitespace-nowrap mt-0.5" title="Se déconnecter">Se déconnecter</a>
                        </div>
                    </div>
                {% else %}
                    <a href="{{ path('app_login') }}" class="text-[#4B5563] hover:text-[#A7C7E7] font-medium focus:outline focus:ring-2 focus:ring-[#A7C7E7] rounded whitespace-nowrap">Connexion</a>
                    <a href="{{ path('register') }}" class="flex items-center gap-2 px-5 py-2.5 rounded-full bg-[#A7C7E7] text-white font-medium hover:bg-[#B8D4ED] focus:outline focus:ring-2 focus:ring-[#A7C7E7] whitespace-nowrap">
                        <svg class="w-5 h-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                        </svg>
                        S'inscrire
                    </a>
                {% endif %}
            </div>
            </div>
        </div>
    </header>
    <main class="flex-1 w-full mx-auto px-4 py-8">
        {% block user_content %}{% endblock %}
    </main>
    {% block footer %}
    <footer class="bg-white border-t border-[#E5E0D8] mt-auto">
        <div class="max-w-6xl mx-auto px-4 py-8 grid grid-cols-1 md:grid-cols-4 gap-8">
            <div>
                <a href="{{ path('home') }}" class="flex items-center gap-2 text-[#4B5563] font-semibold mb-3">
                    <img src="{{ asset('images/logo.png') }}" alt="AutiCare" class="h-20 w-auto object-contain" />
                    AutiCare
                </a>
                <p class="text-[#6B7280] text-sm">Accompagner les personnes autistes et leurs familles avec bienveillance et expertise.</p>
                <p class="text-[#6B7280] text-sm mt-2">contact@auticare.fr</p>
                <p class="text-[#6B7280] text-sm">23 19 88 13</p>
                <p class="text-[#6B7280] text-sm">El Ghazela, Tunis</p>
            </div>
            <div>
                <h3 class="font-semibold text-[#4B5563] mb-3">Navigation</h3>
                <ul class="space-y-2 text-[#6B7280] text-sm">
                    <li><a href="{{ path('home') }}" class="hover:text-[#A7C7E7]">Accueil</a></li>
                    <li><a href="{{ path('user_products_index') }}" class="hover:text-[#A7C7E7]">Produits</a></li>
                    <li><a href="{{ path('user_appointments') }}" class="hover:text-[#A7C7E7]">Rendez-vous</a></li>
                    <li><a href="{{ path('user_events') }}" class="hover:text-[#A7C7E7]">Événements</a></li>
                    <li><a href="{{ path('user_blog') }}" class="hover:text-[#A7C7E7]">Blog</a></li>
                    {% if app.user %}<li><a href="{{ path('user_notifications') }}" class="hover:text-[#A7C7E7]">Notifications</a></li>{% endif %}
                </ul>
            </div>
            <div>
                <h3 class="font-semibold text-[#4B5563] mb-3">Support</h3>
                <ul class="space-y-2 text-[#6B7280] text-sm">
                    <li><a href="#" class="hover:text-[#A7C7E7]">FAQ</a></li>
                    <li><a href="#" class="hover:text-[#A7C7E7]">Contact</a></li>
                    <li><a href="#" class="hover:text-[#A7C7E7]">Accessibilité</a></li>
                </ul>
            </div>
            <div>
                <h3 class="font-semibold text-[#4B5563] mb-3">Informations</h3>
                <ul class="space-y-2 text-[#6B7280] text-sm">
                    <li><a href="#" class="hover:text-[#A7C7E7]">Mentions légales</a></li>
                    <li><a href="#" class="hover:text-[#A7C7E7]">Politique de confidentialité</a></li>
                    <li><a href="#" class="hover:text-[#A7C7E7]">CGV</a></li>
                </ul>
            </div>
        </div>
        <div class="border-t border-[#E5E0D8] py-4 text-center text-[#6B7280] text-sm">
            © {{ "now"|date("Y") }} AutiCare — Ecouter - Aider - Accompagner.
        </div>
    </footer>
    {% endblock %}
</div>
{% endblock %}