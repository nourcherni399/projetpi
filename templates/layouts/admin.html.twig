{% extends 'base.html.twig' %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    window.initThematiqueCharts = function() {
        var el = document.getElementById('thematique-chart-data');
        if (!el || typeof Chart === 'undefined') return;
        try { var data = JSON.parse(el.textContent); } catch (e) { return; }
        var repCtx = document.getElementById('thematiqueRepartitionChart');
        if (repCtx) {
            if (repCtx.chart) repCtx.chart.destroy();
            repCtx.chart = new Chart(repCtx.getContext('2d'), {
                type: 'pie',
                data: {
                    labels: Object.keys(data.repartition || {}),
                    datasets: [{
                        data: Object.values(data.repartition || {}),
                        backgroundColor: ['#2ECC71', '#B0B5B9'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 16, font: { size: 12 } } },
                        tooltip: { callbacks: { label: function(c) { return (c.label || '') + ': ' + (c.parsed || 0) + ' thématique(s)'; } } }
                    }
                }
            });
        }
        var evCtx = document.getElementById('eventsByThematiqueChart');
        if (evCtx) {
            if (evCtx.chart) evCtx.chart.destroy();
            var labels = (data.eventLabels && data.eventLabels.length) ? data.eventLabels : ['Aucune'];
            var values = (data.eventValues && data.eventValues.length) ? data.eventValues : [1];
            var colors = ['#2ECC71', '#F39C12', '#B0B5B9', '#3498DB', '#9B59B6', '#1ABC9C', '#E74C3C', '#95A5A6'];
            var bgColors = values.length ? values.map(function(_, i) { return colors[i % colors.length]; }) : ['#B0B5B9'];
            evCtx.chart = new Chart(evCtx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{ data: values, backgroundColor: bgColors, borderWidth: 2, borderColor: '#ffffff' }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 16, font: { size: 12 } } },
                        tooltip: { callbacks: { label: function(c) { return (c.label || '') + ': ' + (c.parsed || 0) + ' événement(s)'; } } }
                    }
                }
            });
        }
    };
    document.addEventListener('DOMContentLoaded', window.initThematiqueCharts);
    document.addEventListener('turbo:load', window.initThematiqueCharts);
    </script>
{% endblock %}

{% block body %}
<div class="min-h-screen flex flex-col bg-[#F5F1EB]">
    <header class="bg-white border-b border-[#E5E0D8] shrink-0">
        <div class="flex items-center justify-between gap-4 px-6 py-4">
            <a href="{{ path('admin_dashboard') }}" class="flex items-center gap-2 text-[#4B5563] font-semibold text-lg">
                <img src="{{ asset('images/logo.png') }}" alt="AutiCare" class="h-20 w-auto object-contain" />
                AutiCare Admin
            </a>
            <div class="flex-1 max-w-md mx-4">
                <div class="relative">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-[#6B7280]">Q</span>
                    <input type="search" placeholder="Rechercher..." class="w-full pl-8 pr-4 py-2 rounded-full border border-[#E5E0D8] bg-[#F5F1EB] text-[#6B7280] placeholder-[#9CA3AF] focus:outline focus:ring-2 focus:ring-[#A7C7E7]">
                </div>
            </div>
            <div class="flex items-center gap-4">
                <details class="relative group">
                    <summary class="relative list-none cursor-pointer p-2 rounded-full text-[#6B7280] hover:bg-[#F5F1EB]" aria-label="Notifications">
                        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" /></svg>
                        {% if admin_pending_inscriptions|default([])|length > 0 %}
                        <span class="absolute -top-0.5 -right-0.5 flex h-5 w-5 items-center justify-center rounded-full bg-amber-500 text-xs font-medium text-white">{{ admin_pending_inscriptions|length }}</span>
                        {% endif %}
                    </summary>
                    <div class="absolute right-0 mt-2 w-80 rounded-xl bg-white shadow-lg border border-[#E5E0D8] py-2 z-50">
                        <div class="px-4 py-2 border-b border-[#E5E0D8]">
                            <p class="font-medium text-[#4B5563] text-sm">Demandes d'inscription</p>
                        </div>
                        {% if admin_pending_inscriptions|default([]) is empty %}
                        <p class="px-4 py-3 text-[#6B7280] text-sm">Aucune demande en attente.</p>
                        {% else %}
                        {% for ins in admin_pending_inscriptions %}
                        <a href="{{ path('admin_evenement_show', { id: ins.evenement.id }) }}" class="block px-4 py-3 hover:bg-[#F5F1EB] text-sm text-[#4B5563]">
                            <span class="font-medium">{{ ins.user.prenom }} {{ ins.user.nom }}</span> – {{ ins.evenement.title }}
                        </a>
                        {% endfor %}
                        {% endif %}
                    </div>
                </details>
                <div class="flex items-center gap-3">
                    <a href="{{ path('admin_profile') }}" class="flex items-center gap-3 hover:opacity-90 transition-opacity group" title="Modifier mon profil">
                        <span class="flex items-center justify-center w-10 h-10 rounded-full overflow-hidden bg-[#A7C7E7] text-white font-semibold text-sm group-hover:ring-2 group-hover:ring-[#A7C7E7] group-hover:ring-offset-1 transition-all shrink-0">{% if app.user and app.user.image %}<img src="{{ asset(app.user.image) }}" alt="" class="w-full h-full object-cover">{% else %}{{ app.user ? (app.user.prenom|slice(0,1) ~ app.user.nom|slice(0,1))|upper : 'AD' }}{% endif %}</span>
                        <div>
                            <p class="font-medium text-[#4B5563] text-sm group-hover:text-[#A7C7E7]">{{ app.user ? app.user.prenom ~ ' ' ~ app.user.nom : 'Admin' }}</p>
                            <p class="text-[#6B7280] text-xs">{{ app.user ? app.user.email : 'admin@auticare.fr' }}</p>
                        </div>
                    </a>
                    <a href="{{ path('app_logout') }}" class="flex items-center gap-2 px-3 py-2 rounded-xl text-[#6B7280] hover:bg-red-50 hover:text-red-600 text-sm font-medium transition-colors" title="Se déconnecter">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                        Se déconnecter
                    </a>
                </div>
            </div>
        </div>
    </header>
    <div class="flex flex-1 min-h-0">
        <aside class="w-64 bg-white border-r border-[#E5E0D8] flex flex-col shrink-0">
            <nav class="p-4 flex-1" aria-label="Navigation principale">
                <ul class="space-y-1">
                    <li><a href="{{ path('admin_dashboard') }}" class="flex items-center gap-3 px-4 py-3 rounded-xl bg-[#A7C7E7]/15 text-[#A7C7E7] font-medium focus:outline focus:ring-2 focus:ring-[#A7C7E7]">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" /></svg>
                        Tableau de bord
                    </a></li>
                    <li><a href="{{ path('admin_users') }}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-[#6B7280] hover:bg-[#F5F1EB] hover:text-[#4B5563] focus:outline focus:ring-2 focus:ring-[#A7C7E7]">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" /></svg>
                        Utilisateurs
                    </a></li>
                    <li><a href="{{ path('admin_produit_index') }}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-[#6B7280] hover:bg-[#F5F1EB] hover:text-[#4B5563] focus:outline focus:ring-2 focus:ring-[#A7C7E7]">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" /></svg>
                        Produits
                    </a></li>
                    <li><a href="{{ path('admin_stock_index') }}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-[#6B7280] hover:bg-[#F5F1EB] hover:text-[#4B5563] focus:outline focus:ring-2 focus:ring-[#A7C7E7]">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h13.125c.621 0 1.125.504 1.125 1.125v4.125c0 .621-.504 1.125-1.125 1.125H3.375c-.621 0-1.125-.504-1.125-1.125V8.625C2.25 8.004 2.754 7.5 3.375 7.5" /></svg>
                        Stocks
                    </a></li>
                    <li><a href="{{ path('admin_evenement_index') }}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-[#6B7280] hover:bg-[#F5F1EB] hover:text-[#4B5563] focus:outline focus:ring-2 focus:ring-[#A7C7E7]">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" /></svg>
                        Événements
                    </a></li>
                    <li><a href="{{ path('admin_thematique_index') }}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-[#6B7280] hover:bg-[#F5F1EB] hover:text-[#4B5563] focus:outline focus:ring-2 focus:ring-[#A7C7E7]">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" /></svg>
                        Thématiques
                    </a></li>
                    <li><a href="{{ path('admin_dashboard') }}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-[#6B7280] hover:bg-[#F5F1EB] hover:text-[#4B5563] focus:outline focus:ring-2 focus:ring-[#A7C7E7]">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z" /></svg>
                        Modules
                    </a></li>
                    <li><a href="#" class="flex items-center gap-3 px-4 py-3 rounded-xl text-[#6B7280] hover:bg-[#F5F1EB] hover:text-[#4B5563] focus:outline focus:ring-2 focus:ring-[#A7C7E7]">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.329-.183.581-.495.644-.869l.214-1.281z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                        Paramètres
                    </a></li>
                </ul>
            </nav>
            <div class="p-4 border-t border-[#E5E0D8]">
                <a href="{{ path('admin_dashboard') }}" class="flex items-center gap-2 px-4 py-2 text-sm text-[#A7C7E7] hover:underline font-medium">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" /></svg>
                    Accueil admin
                </a>
            </div>
        </aside>
        <main class="flex-1 overflow-auto p-8">
            {% block admin_content %}{% endblock %}
        </main>
    </div>
</div>
{% endblock %}