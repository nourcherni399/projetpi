{% extends 'layouts/admin.html.twig' %}

{% block title %}Utilisateurs - AutiCare Admin{% endblock %}

{% block admin_content %}
<div class="w-full max-w-[1600px]">
<h1 class="text-2xl font-semibold text-[#4B5563] mb-6">Gestion des utilisateurs</h1>
{% for message in app.flashes('success') %}
    <div class="mb-4 px-4 py-3 rounded-lg bg-emerald-50 border border-emerald-200 text-emerald-800">{{ message }}</div>
{% endfor %}
{% for message in app.flashes('error') %}
    <div class="mb-4 px-4 py-3 rounded-lg bg-red-50 border border-red-200 text-red-800">{{ message }}</div>
{% endfor %}

{% if stats is defined %}
<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
    <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl border border-slate-200 p-5 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-slate-600 text-sm font-medium">Total</p>
                <p class="text-2xl font-bold text-slate-800 mt-1">{{ stats.total }}</p>
            </div>
            <div class="flex items-center justify-center w-11 h-11 rounded-full bg-slate-200">
                <svg class="w-5 h-5 text-slate-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-3.382a4.37 4.37 0 00-.94-2.607m7.006 7.006a9.39 9.39 0 01-2.625.372 9.337 9.337 0 01-4.121-.952 4.125 4.125 0 017.533-2.493M15 19.128v-3.382a4.37 4.37 0 01-.94-2.607m0 0a4.37 4.37 0 01-.94 2.607M15 12.128a9.39 9.39 0 012.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 12.128v-3.382a4.37 4.37 0 00-.94-2.607M7 9.128v3.382a4.37 4.37 0 01-.94 2.607M7 9.128a4.37 4.37 0 01-.94-2.607m0 0a4.37 4.37 0 01.94-2.607" /></svg>
            </div>
        </div>
    </div>
    <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-xl border border-emerald-200 p-5 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-emerald-600 text-sm font-medium">Actifs</p>
                <p class="text-2xl font-bold text-emerald-800 mt-1">{{ stats.actifs }}</p>
            </div>
            <div class="flex items-center justify-center w-11 h-11 rounded-full bg-emerald-200">
                <svg class="w-5 h-5 text-emerald-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            </div>
        </div>
    </div>
    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl border border-blue-200 p-5 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-blue-600 text-sm font-medium">Admins</p>
                <p class="text-2xl font-bold text-blue-800 mt-1">{{ stats.admins }}</p>
            </div>
            <div class="flex items-center justify-center w-11 h-11 rounded-full bg-blue-200">
                <svg class="w-5 h-5 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 010 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 010-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
            </div>
        </div>
    </div>
    <div class="bg-gradient-to-br from-teal-50 to-teal-100 rounded-xl border border-teal-200 p-5 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-teal-600 text-sm font-medium">Médecins</p>
                <p class="text-2xl font-bold text-teal-800 mt-1">{{ stats.medecins }}</p>
            </div>
            <div class="flex items-center justify-center w-11 h-11 rounded-full bg-teal-200">
                <svg class="w-5 h-5 text-teal-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.62 48.62 0 0 1 12 20.904a48.62 48.62 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.636 50.636 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.903 59.903 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.717 50.717 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443m-7.007 11.55A5.981 5.981 0 0 0 6.75 15.75v-1.5" /></svg>
            </div>
        </div>
    </div>
    <div class="bg-gradient-to-br from-violet-50 to-violet-100 rounded-xl border border-violet-200 p-5 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-violet-600 text-sm font-medium">Patients</p>
                <p class="text-2xl font-bold text-violet-800 mt-1">{{ stats.patients }}</p>
            </div>
            <div class="flex items-center justify-center w-11 h-11 rounded-full bg-violet-200">
                <svg class="w-5 h-5 text-violet-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>
            </div>
        </div>
    </div>
    <div class="bg-gradient-to-br from-amber-50 to-amber-100 rounded-xl border border-amber-200 p-5 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-amber-600 text-sm font-medium">Parents</p>
                <p class="text-2xl font-bold text-amber-800 mt-1">{{ stats.parents }}</p>
            </div>
            <div class="flex items-center justify-center w-11 h-11 rounded-full bg-amber-200">
                <svg class="w-5 h-5 text-amber-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.971 5.971 0 00-.941-3.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-5.058 2.772m0 0a3 3 0 00-4.681 2.72 8.986 8.986 0 003.74.477m.94-3.197a5.971 5.971 0 00-.94 3.197M15 6.75a3 3 0 11-6 0 3 3 0 016 0zm6 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-13.5 0a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z" /></svg>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="bg-white rounded-xl border border-[#E5E0D8] overflow-hidden shadow-sm">
    <div class="p-4 border-b border-[#E5E0D8] flex flex-wrap gap-4 justify-between items-center bg-gradient-to-r from-[#F5F1EB] to-white">
        <div class="flex flex-wrap gap-2 items-center">
            <span class="text-[#4B5563] text-sm font-medium">Tri :</span>
            <a href="{{ path('admin_users', { order: 'asc' }) }}" class="px-3 py-1.5 rounded-lg text-sm font-medium {{ (order|default('asc')) == 'asc' ? 'bg-[#A7C7E7] text-white shadow-sm' : 'bg-white border border-[#E5E0D8] text-[#4B5563] hover:bg-[#F5F1EB]' }}">A → Z</a>
            <a href="{{ path('admin_users', { order: 'desc' }) }}" class="px-3 py-1.5 rounded-lg text-sm font-medium {{ (order|default('asc')) == 'desc' ? 'bg-[#A7C7E7] text-white shadow-sm' : 'bg-white border border-[#E5E0D8] text-[#4B5563] hover:bg-[#F5F1EB]' }}">Z → A</a>
        </div>
        <a href="{{ path('admin_user_new') }}" class="inline-flex items-center gap-2 px-4 py-2.5 rounded-lg bg-[#A7C7E7] text-white font-medium hover:bg-[#B8D4ED] focus:outline focus:ring-2 focus:ring-[#A7C7E7] shadow-sm">
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
            Nouvel utilisateur
        </a>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full text-left">
            <thead class="bg-[#F5F1EB] border-b-2 border-[#E5E0D8]">
                <tr>
                    <th class="px-6 py-4 font-semibold text-[#4B5563] w-16">Photo</th>
                    <th class="px-6 py-4 font-semibold text-[#4B5563]">Nom</th>
                    <th class="px-6 py-4 font-semibold text-[#4B5563]">Email</th>
                    <th class="px-6 py-4 font-semibold text-[#4B5563]">Rôle</th>
                    <th class="px-6 py-4 font-semibold text-[#4B5563] text-right">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-[#E5E0D8]">
                {% for user in users %}
                <tr class="hover:bg-[#F5F1EB]/60 transition-colors">
                    <td class="px-6 py-4">
                        <div class="flex items-center justify-center w-10 h-10 rounded-full overflow-hidden bg-[#E5E0D8] shrink-0">
                            {% if user.image %}
                                <img src="{{ asset(user.image) }}" alt="" class="w-full h-full object-cover">
                            {% else %}
                                <svg class="w-5 h-5 text-[#6B7280]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>
                            {% endif %}
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="font-medium text-[#4B5563]">{{ user.nom }} {{ user.prenom }}</span>
                    </td>
                    <td class="px-6 py-4 text-[#6B7280]">{{ user.email }}</td>
                    <td class="px-6 py-4">
                        {% set roleValue = user.role ? user.role.value : '' %}
                        <span class="inline-flex px-2.5 py-1 rounded-lg text-xs font-semibold
                            {% if roleValue == 'ROLE_ADMIN' %}bg-blue-100 text-blue-800
                            {% elseif roleValue == 'ROLE_MEDECIN' %}bg-teal-100 text-teal-800
                            {% elseif roleValue == 'ROLE_PATIENT' or roleValue == 'ROLE_USER' %}bg-violet-100 text-violet-800
                            {% elseif roleValue == 'ROLE_PARENT' %}bg-amber-100 text-amber-800
                            {% else %}bg-slate-100 text-slate-700{% endif %}">
                            {{ roleValue ? roleValue|replace({'ROLE_': ''}) : '—' }}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex gap-2 justify-end">
                            <a href="{{ path('admin_user_show', { id: user.id }) }}" class="inline-flex items-center justify-center w-10 h-10 rounded-lg bg-emerald-100 text-emerald-600 hover:bg-emerald-200 focus:outline focus:ring-2 focus:ring-emerald-500 transition-colors" title="Voir">
                                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                            </a>
                            <a href="{{ path('admin_user_edit', { id: user.id }) }}" class="inline-flex items-center justify-center w-10 h-10 rounded-lg bg-blue-100 text-blue-600 hover:bg-blue-200 focus:outline focus:ring-2 focus:ring-blue-500 transition-colors" title="Modifier">
                                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                            </a>
                            <a href="{{ path('admin_user_confirm_delete', { id: user.id }) }}" class="inline-flex items-center justify-center w-10 h-10 rounded-lg bg-red-100 text-red-600 hover:bg-red-200 focus:outline focus:ring-2 focus:ring-red-500 transition-colors" title="Supprimer">
                                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                            </a>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="5" class="px-6 py-12 text-center text-[#6B7280]">Aucun utilisateur.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
</div>
{% endblock %}
