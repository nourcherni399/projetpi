{% extends 'layouts/admin.html.twig' %}

{% block title %}Thématiques - AutiCare Admin{% endblock %}

{% block admin_content %}
<h1 class="text-2xl font-semibold text-[#4B5563] mb-6">Gestion des thématiques</h1>
{% for message in app.flashes('success') %}
    <div class="mb-4 px-4 py-3 rounded-lg bg-emerald-50 border border-emerald-200 text-emerald-800">{{ message }}</div>
{% endfor %}
<form method="get" action="{{ path('admin_thematique_index') }}" class="mb-6 flex flex-wrap gap-4 justify-between items-center">
    <input type="search" name="q" value="{{ q|default('') }}" placeholder="Rechercher une thématique…" class="px-4 py-2 rounded-lg border border-[#E5E0D8] bg-[#F5F1EB] text-[#4B5563] placeholder-[#9CA3AF] focus:outline focus:ring-2 focus:ring-[#A7C7E7] max-w-xs w-full min-w-[200px]">
    <div class="flex gap-2">
        <button type="submit" class="px-4 py-2 rounded-lg bg-[#F5F1EB] border border-[#E5E0D8] text-[#4B5563] font-medium hover:bg-[#E5E0D8] focus:outline focus:ring-2 focus:ring-[#A7C7E7]">Rechercher</button>
        <a href="{{ path('admin_thematique_new') }}" class="px-4 py-2 rounded-lg bg-[#A7C7E7] text-white font-medium hover:bg-[#B8D4ED] focus:outline focus:ring-2 focus:ring-[#A7C7E7]">Nouvel élément</a>
    </div>
</form>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {% for thematique in thematiques %}
    <a href="{{ path('admin_thematique_show', { id: thematique.id }) }}" class="group block bg-white rounded-xl border border-[#E5E0D8] overflow-hidden hover:shadow-md transition-shadow duration-200 focus:outline focus:ring-2 focus:ring-[#A7C7E7] focus:ring-offset-2 {{ thematique.couleur ? 'border-l-4' : '' }}" {% if thematique.couleur %}style="border-left-color: {{ thematique.couleur }};"{% endif %}>
        {% if thematique.image %}
        {% set imgUrl = thematique.image starts with 'http' ? thematique.image : asset(thematique.image) %}
        <div class="aspect-[21/9] max-h-36 bg-[#E5E0D8] overflow-hidden">
            <img src="{{ imgUrl }}" alt="{{ thematique.nomThematique }}" class="w-full h-full object-cover" loading="lazy">
        </div>
        {% endif %}
        <div class="p-5 flex flex-col h-full relative">
            <span class="absolute top-4 right-4 flex items-center justify-center w-8 h-8 rounded-full bg-[#A7C7E7] text-white text-sm font-semibold">{{ thematique.id }}</span>
            <h2 class="text-lg font-semibold text-[#4B5563] pr-10 mb-1">{{ thematique.nomThematique }}</h2>
            <p class="text-[#6B7280] text-sm mb-2">Code : {{ thematique.codeThematique }}</p>
            {% if thematique.sousTitre %}
            <p class="text-[#6B7280] text-sm mb-2">{{ thematique.sousTitre }}</p>
            {% elseif thematique.publicCible is defined and thematique.publicCible %}
            <p class="text-[#6B7280] text-sm mb-2">{{ thematique.publicCible is iterable ? thematique.publicCible.value|default(thematique.publicCible) : thematique.publicCible }}</p>
            {% endif %}
            <div class="mt-auto pt-3 flex flex-wrap items-center gap-2">
                <span class="text-[#A7C7E7] font-medium text-sm">{{ thematique.evenements|length }} événement{{ thematique.evenements|length != 1 ? 's' : '' }}</span>
                {% if thematique.couleur %}
                <span class="w-3 h-3 rounded-full shrink-0" style="background-color: {{ thematique.couleur }};" title="{{ thematique.couleur }}"></span>
                {% endif %}
                {% if not thematique.actif %}
                <span class="ml-auto text-xs px-2 py-1 rounded bg-[#E5E0D8] text-[#6B7280]">Masquée</span>
                {% endif %}
            </div>
        </div>
    </a>
    {% else %}
    <div class="col-span-full bg-white rounded-xl border border-[#E5E0D8] px-6 py-12 text-center text-[#6B7280]">
        Aucune thématique.
    </div>
    {% endfor %}
</div>
{% endblock %}