{% extends 'layouts/user.html.twig' %}

{% block title %}Confirmer la commande - AutiCare{% endblock %}

{% block user_content %}
<section class="text-center mb-10">
    <h1 class="text-3xl font-bold text-[#4B5563]">Confirmer votre commande</h1>
</section>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
    <!-- Formulaire -->
    <div class="lg:col-span-2">
        <div class="bg-white rounded-xl shadow-sm border border-[#E5E0D8] p-8">
            {{ form_start(form, {'attr': {'class': 'space-y-6'}}) }}
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    {{ form_row(form.nom) }}
                </div>
                <div>
                    {{ form_row(form.email) }}
                </div>
            </div>

            <div>
                {{ form_row(form.telephone) }}
            </div>

            <div>
                {{ form_row(form.adresse) }}
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    {{ form_row(form.codePostal) }}
                </div>
                <div>
                    {{ form_row(form.ville) }}
                </div>
            </div>

            <div>
                {{ form_row(form.modePayment) }}
            </div>

            <!-- Section paiement par carte (cachée par défaut) -->
            <div id="card-payment" class="hidden bg-[#F5F1EB] rounded-lg p-6 border border-[#E5E0D8]">
                <h3 class="font-semibold text-[#4B5563] mb-4">Détails de la carte bancaire</h3>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-[#4B5563] mb-2">Numéro de carte</label>
                    <input type="text" name="card_number" placeholder="1234 5678 9012 3456" class="w-full px-4 py-2 border border-[#E5E0D8] rounded-lg" maxlength="19">
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[#4B5563] mb-2">Date d'expiration</label>
                        <input type="text" name="card_expiry" placeholder="MM/YY" class="w-full px-4 py-2 border border-[#E5E0D8] rounded-lg" maxlength="5">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[#4B5563] mb-2">CVC</label>
                        <input type="text" name="card_cvc" placeholder="123" class="w-full px-4 py-2 border border-[#E5E0D8] rounded-lg" maxlength="4">
                    </div>
                </div>
            </div>

            <div class="flex gap-4 pt-6">
                <a href="{{ path('cart_view') }}" class="flex-1 px-6 py-3 border border-[#A7C7E7] text-[#A7C7E7] rounded-lg hover:bg-[#F5F1EB] text-center">Retour</a>
                <button type="submit" class="flex-1 px-6 py-3 bg-[#A7C7E7] text-white rounded-lg hover:bg-[#B8D4ED]">Confirmer la commande</button>
            </div>

            {{ form_end(form) }}
        </div>
    </div>

    <!-- Résumé du panier -->
    <div class="lg:col-span-1">
        <div class="bg-white rounded-xl shadow-sm border border-[#E5E0D8] p-6 sticky top-24">
            <h2 class="font-bold text-[#4B5563] mb-6">Résumé</h2>
            
            <div class="space-y-4 mb-6 pb-6 border-b border-[#E5E0D8]">
                {% set total = 0 %}
                {% for item in cart %}
                    {% set sousTotal = item.prix * item.quantite %}
                    {% set total = total + sousTotal %}
                    <div class="flex justify-between text-sm">
                        <span class="text-[#6B7280]">{{ item.nom }} x {{ item.quantite }}</span>
                        <span class="font-medium text-[#4B5563]">{{ sousTotal|number_format(2, ',', ' ') }} د.ت</span>
                    </div>
                {% endfor %}
            </div>

            <div class="space-y-3">
                <div class="flex justify-between text-sm text-[#6B7280]">
                    <span>Sous-total</span>
                    <span>{{ total|number_format(2, ',', ' ') }} د.ت</span>
                </div>
                <div class="flex justify-between text-sm text-[#6B7280]">
                    <span>Livraison</span>
                    <span>Gratuit</span>
                </div>
                <div class="flex justify-between font-bold text-lg text-[#A7C7E7] pt-3 border-t border-[#E5E0D8]">
                    <span>Total</span>
                    <span>{{ total|number_format(2, ',', ' ') }} د.ت</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const modeSelect = document.querySelector('[name="commande_modePayment"]');
    const cardPaymentDiv = document.getElementById('card-payment');
    
    if (modeSelect) {
        function toggleCardPayment() {
            const value = modeSelect.value;
            if (value === 'a_la_livraison') {
                cardPaymentDiv.classList.add('hidden');
                // Vider les champs de carte
                document.querySelector('[name="card_number"]').value = '';
                document.querySelector('[name="card_expiry"]').value = '';
                document.querySelector('[name="card_cvc"]').value = '';
            } else {
                cardPaymentDiv.classList.remove('hidden');
            }
        }
        
        modeSelect.addEventListener('change', toggleCardPayment);
        toggleCardPayment(); // Appel initial
    }
});
</script>
{% endblock %}
