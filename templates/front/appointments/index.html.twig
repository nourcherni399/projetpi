{% extends 'layouts/user.html.twig' %}

{% block title %}Prendre un rendez-vous - AutiCare{% endblock %}

{% block user_content %}
<section class="mb-8">
    <h1 class="text-3xl font-bold text-[#4B5563] mb-2">Prendre un rendez-vous</h1>
    <p class="text-[#6B7280]">Consultez nos médecins et spécialistes, puis réservez votre créneau en quelques clics.</p>
</section>

<div class="flex flex-col lg:flex-row gap-8">
    <aside class="lg:w-80 shrink-0">
        <div class="bg-white rounded-2xl shadow-sm border border-[#E5E0D8] p-6 sticky top-4">
            <div class="flex items-center justify-between mb-6">
                <h2 class="font-bold text-[#4B5563]">Filtres</h2>
            </div>
            <div class="space-y-5">
                <div>
                    <label for="filter-specialty" class="block font-semibold text-[#4B5563] mb-2">Spécialité</label>
                    <select id="filter-specialty" class="w-full px-4 py-2.5 rounded-lg border border-[#E5E0D8] bg-white text-[#6B7280] focus:outline focus:ring-2 focus:ring-[#A7C7E7]">
                        <option value="">Toutes les spécialités</option>
                        {% for spec in specialites|default([]) %}
                        <option value="{{ spec }}">{{ spec }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="filter-place" class="block font-semibold text-[#4B5563] mb-2">Lieu</label>
                    <input type="text" id="filter-place" placeholder="Ville ou adresse..." class="w-full px-4 py-2.5 rounded-lg border border-[#E5E0D8] bg-white text-[#6B7280] placeholder-[#9CA3AF] focus:outline focus:ring-2 focus:ring-[#A7C7E7]">
                </div>
            </div>
            <div class="mt-6 p-4 rounded-xl bg-[#F5F1EB] border border-[#E5E0D8]">
                <h3 class="font-semibold text-[#4B5563] mb-2">Besoin d'aide ?</h3>
                <p class="text-[#6B7280] text-sm">Choisissez un praticien puis cliquez sur « Prendre RDV » pour voir ses créneaux disponibles.</p>
            </div>
        </div>
    </aside>

    <div class="flex-1 min-w-0">
        <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
            <p class="text-[#6B7280]"><span id="medecins-count">{{ medecins|length }}</span> professionnel(s) disponible(s)</p>
        </div>
        <ul class="space-y-4" id="medecins-list">
            {% for medecin in medecins %}
            {% set spec = medecin.specialite|default('Spécialiste') %}
            {% set spec_class = spec matches '/psychiatre/i' or spec matches '/psychologue/i' ? 'bg-emerald-100 text-emerald-800' : (spec matches '/orthophoniste/i' ? 'bg-sky-100 text-sky-800' : 'bg-[#A7C7E7]/20 text-[#4B5563]') %}
            {% set initiales = ((medecin.nom|slice(0, 1)) ~ (medecin.prenom|slice(0, 1)))|upper|default('DR') %}
            <li class="medecin-card bg-white rounded-2xl shadow-sm border border-[#E5E0D8] p-6 flex flex-col sm:flex-row gap-6" data-specialty="{{ spec }}" data-address="{{ medecin.adresseCabinet|default('')|lower }}">
                <div class="flex items-center justify-center w-14 h-14 rounded-full bg-[#A7C7E7]/30 text-[#4B5563] font-semibold text-sm shrink-0">{{ initiales }}</div>
                <div class="flex-1 min-w-0">
                    <div class="flex flex-wrap items-center gap-2 mb-2">
                        <h3 class="font-bold text-[#4B5563]">Dr. {{ medecin.nom }} {{ medecin.prenom }}</h3>
                        <span class="px-2 py-0.5 rounded-full text-xs font-medium {{ spec_class }}">{{ spec }}</span>
                    </div>
                    <p class="text-[#6B7280] text-sm mb-3">
                        {% if medecin.nomCabinet %}Cabinet : {{ medecin.nomCabinet }}.{% endif %}
                        {% if medecin.specialite %}Spécialité : {{ medecin.specialite }}.{% endif %}
                    </p>
                    <div class="flex flex-wrap gap-4 text-sm text-[#6B7280] mb-3">
                        {% if medecin.adresseCabinet %}
                        <span class="flex items-center gap-1">
                            <svg class="w-4 h-4 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /></svg>
                            {{ medecin.adresseCabinet }}
                        </span>
                        {% endif %}
                    </div>
                    <div class="flex flex-wrap gap-2">
                        {% if medecin.adresseCabinet %}
                        <span class="inline-flex items-center gap-1 px-2 py-1 rounded-lg border border-[#E5E0D8] text-[#6B7280] text-sm">
                            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008z" /></svg>
                            Cabinet
                        </span>
                        {% endif %}
                        <span class="inline-flex items-center gap-1 px-2 py-1 rounded-lg border border-[#E5E0D8] text-[#6B7280] text-sm">
                            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>
                            Téléconsultation
                        </span>
                    </div>
                </div>
                <div class="sm:text-right shrink-0 flex flex-col justify-center gap-2">
                    {% if medecin.telephoneCabinet or medecin.telephone %}
                    <p class="text-sm text-[#6B7280] flex items-center gap-1 sm:justify-end">
                        <svg class="w-4 h-4 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                        {{ medecin.telephoneCabinet|default(medecin.telephone) }}
                    </p>
                    {% endif %}
                    {% if medecin.tarifConsultation %}
                    <p class="font-semibold text-[#4B5563]">{{ medecin.tarifConsultation|number_format(0, ',', ' ') }} €</p>
                    {% endif %}
                    <a href="{{ path('user_appointment_book', { id: medecin.id }) }}" class="inline-flex justify-center sm:justify-end px-4 py-2.5 rounded-lg bg-[#A7C7E7] text-white font-medium hover:bg-[#B8D4ED] focus:outline focus:ring-2 focus:ring-[#A7C7E7]">Prendre RDV</a>
                </div>
            </li>
            {% else %}
            <li class="bg-white rounded-2xl shadow-sm border border-[#E5E0D8] p-12 text-center">
                <p class="text-[#6B7280] mb-4">Aucun médecin n'est encore enregistré sur la plateforme.</p>
                <p class="text-sm text-[#6B7280]">Revenez plus tard ou contactez-nous pour être orienté.</p>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>

<script>
(function() {
    var filterSpecialty = document.getElementById('filter-specialty');
    var filterPlace = document.getElementById('filter-place');
    var cards = document.querySelectorAll('.medecin-card');
    var countEl = document.getElementById('medecins-count');

    function updateList() {
        var spec = (filterSpecialty && filterSpecialty.value) ? filterSpecialty.value.toLowerCase() : '';
        var place = (filterPlace && filterPlace.value) ? filterPlace.value.trim().toLowerCase() : '';
        var visible = 0;
        cards.forEach(function(card) {
            var cardSpec = (card.getAttribute('data-specialty') || '').toLowerCase();
            var cardAddr = card.getAttribute('data-address') || '';
            var matchSpec = !spec || cardSpec.indexOf(spec) !== -1;
            var matchPlace = !place || cardAddr.indexOf(place) !== -1;
            var show = matchSpec && matchPlace;
            card.style.display = show ? '' : 'none';
            if (show) visible++;
        });
        if (countEl) countEl.textContent = visible;
    }
    if (filterSpecialty) filterSpecialty.addEventListener('change', updateList);
    if (filterPlace) filterPlace.addEventListener('input', updateList);
})();
</script>
{% endblock %}
