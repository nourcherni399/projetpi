{% extends 'layouts/user.html.twig' %}

{% block title %}Mon Panier - AutiCare{% endblock %}

{% block user_content %}
<section class="text-center mb-10">
    <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-[#A7C7E7]/20 text-[#A7C7E7] mb-4">
        <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" /></svg>
    </div>
    <h1 class="text-3xl font-bold text-[#4B5563] mb-3">Mon Panier</h1>
</section>

<div class="max-w-4xl mx-auto">
    {% if cart|length > 0 %}
        <div class="bg-white rounded-xl shadow-sm border border-[#E5E0D8] overflow-hidden">
            <table class="w-full">
                <thead class="bg-[#F5F1EB] border-b border-[#E5E0D8]">
                    <tr>
                        <th class="px-6 py-4 text-left text-sm font-semibold text-[#4B5563]">Produit</th>
                        <th class="px-6 py-4 text-center text-sm font-semibold text-[#4B5563]">Prix</th>
                        <th class="px-6 py-4 text-center text-sm font-semibold text-[#4B5563]">Quantité</th>
                        <th class="px-6 py-4 text-center text-sm font-semibold text-[#4B5563]">Sous-total</th>
                        <th class="px-6 py-4 text-center text-sm font-semibold text-[#4B5563]">Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% set total = 0 %}
                    {% for item in cart %}
                        {% set sousTotal = item.prix * item.quantite %}
                        {% set total = total + sousTotal %}
                        <tr class="border-b border-[#E5E0D8] hover:bg-[#F5F1EB]">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-4">
                                    {% if item.image %}
                                        <img src="{{ asset(item.image) }}" alt="{{ item.nom }}" class="w-16 h-16 object-cover rounded">
                                    {% else %}
                                        <div class="w-16 h-16 bg-[#E5E0D8] rounded flex items-center justify-center text-[#9CA3AF]">—</div>
                                    {% endif %}
                                    <div>
                                        <h3 class="font-semibold text-[#4B5563]">{{ item.nom }}</h3>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 text-center text-[#6B7280]">{{ item.prix|number_format(2, ',', ' ') }} د.ت</td>
                            <td class="px-6 py-4">
                                <form method="POST" action="{{ path('cart_update', {id: item.id}) }}" class="flex justify-center gap-2">
                                    <input type="number" name="quantite" value="{{ item.quantite }}" min="1" class="w-16 px-2 py-1 border border-[#E5E0D8] rounded text-center">
                                    <button type="submit" class="px-2 py-1 bg-[#A7C7E7] text-white rounded text-sm hover:bg-[#B8D4ED]">Maj</button>
                                </form>
                            </td>
                            <td class="px-6 py-4 text-center font-semibold text-[#A7C7E7]">{{ sousTotal|number_format(2, ',', ' ') }} د.ت</td>
                            <td class="px-6 py-4 text-center">
                                <form method="POST" action="{{ path('cart_remove', {id: item.id}) }}" style="display: inline;">
                                    <button type="submit" class="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600">Supprimer</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="mt-8 flex justify-between items-center">
            <a href="{{ path('user_products') }}" class="px-6 py-2 border border-[#A7C7E7] text-[#A7C7E7] rounded-lg hover:bg-[#F5F1EB]">Continuer les achats</a>
            <div class="text-right">
                <div class="text-[#6B7280] mb-2">Total: <span class="text-2xl font-bold text-[#A7C7E7]">{{ total|number_format(2, ',', ' ') }} د.ت</span></div>
                <a href="{{ path('checkout') }}" class="inline-block px-8 py-3 bg-[#A7C7E7] text-white rounded-lg hover:bg-[#B8D4ED]">Passer la commande</a>
            </div>
        </div>
    {% else %}
        <div class="bg-white rounded-xl shadow-sm border border-[#E5E0D8] p-12 text-center">
            <svg class="w-16 h-16 mx-auto mb-4 text-[#E5E0D8]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
            </svg>
            <p class="text-[#6B7280] mb-4">Votre panier est vide</p>
            <a href="{{ path('user_products') }}" class="inline-block px-6 py-2 bg-[#A7C7E7] text-white rounded-lg hover:bg-[#B8D4ED]">Découvrir nos produits</a>
        </div>
    {% endif %}
</div>
{% endblock %}
